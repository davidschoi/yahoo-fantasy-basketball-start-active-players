var h=Object.defineProperty;var g=(o,e,t)=>e in o?h(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var u=(o,e,t)=>g(o,typeof e!="symbol"?e+"":e,t);class y{constructor(){u(this,"isProcessing",!1);u(this,"originalUrl","");u(this,"results",{totalDays:7,processedDays:0,daysWithExceptions:[],summary:""});this.setupMessageListener()}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,a)=>e.action==="processWeeklyLineups"?(this.processWeeklyLineups().then(s=>{a({success:!0,weeklyResults:s})}).catch(s=>{a({success:!1,error:s.message})}),!0):e.action==="getDayResult"?(this.handleDayResult(e.dayResult),a({success:!0}),!0):!1)}async processWeeklyLineups(){if(this.isProcessing)throw new Error("Weekly processing already in progress");this.isProcessing=!0,this.results={totalDays:7,processedDays:0,daysWithExceptions:[],summary:""};try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e||!e.id)throw new Error("No active tab found");this.originalUrl=e.url||"";const t=this.getCurrentDate(e.url||""),a=new Date(t),s=a.getDay(),r=s===0?1:7-s+1;console.log(`Current day: ${s}, Total days to process: ${r}`);for(let i=0;i<r;i++){const l=new Date(a);l.setDate(a.getDate()+i),console.log(`Processing day ${i}: ${l.toDateString()} (day ${l.getDay()})`);const c=this.formatDate(l);console.log(`Navigating to date: ${c}`);try{await this.navigateToDate(e.id,c),await this.delay(3e3);const n=await chrome.tabs.sendMessage(e.id,{action:"processDay",date:c});n!=null&&n.success&&(this.results.processedDays++,(n.dayResult.needsManualSelection||n.dayResult.exceptions.length>0)&&this.results.daysWithExceptions.push(n.dayResult))}catch(n){console.error(`Error processing ${c}:`,n),this.results.daysWithExceptions.push({date:c,started:0,exceptions:[`Error: ${n.message}`],needsManualSelection:!0})}}return this.results.summary=this.generateWeeklySummary(this.results),console.log("Weekly lineup processing completed! 📊"),console.log(this.results.summary),this.originalUrl&&(await chrome.tabs.update(e.id,{url:this.originalUrl}),console.log(`Navigated back to original URL: ${this.originalUrl}`)),this.results}finally{this.isProcessing=!1}}async navigateToDate(e,t){const a=await chrome.tabs.get(e),s=new URL(a.url||"");s.searchParams.set("date",t),await chrome.tabs.update(e,{url:s.toString()}),await this.waitForTabLoad(e)}async waitForTabLoad(e){return new Promise(t=>{const a=(s,r)=>{s===e&&r.status==="complete"&&(chrome.tabs.onUpdated.removeListener(a),t())};chrome.tabs.onUpdated.addListener(a)})}handleDayResult(e){this.results.processedDays++,(e.needsManualSelection||e.exceptions.length>0)&&this.results.daysWithExceptions.push(e)}generateWeeklySummary(e){const t=e.daysWithExceptions.filter(s=>s.exceptions.some(r=>r.includes("Remaining bench players")));if(t.length===0)return"All active players started successfully! 🎉";let a=`Days needing manual review:
`;return t.forEach(s=>{const r=s.exceptions.filter(i=>i.includes("Remaining bench players")).map(i=>i.replace("Remaining bench players with games: ","")).join(", ");a+=`${s.date}: ${s.started} players with games
`,a+=`⚠️ Remaining bench players with games: ${r}
`}),a}getCurrentDate(e){try{const s=new URL(e).searchParams.get("date");if(s)return this.parseLocalDate(s)}catch{}const t=new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())}parseLocalDate(e){const t=e.split("-"),a=parseInt(t[0]||"0",10),s=parseInt(t[1]||"0",10),r=parseInt(t[2]||"1",10);return new Date(a,s?s-1:0,r)}formatDate(e){const t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${s}`}delay(e){return new Promise(t=>setTimeout(t,e))}}new y;
