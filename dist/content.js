class u{constructor(){this.setupMessageListener()}setupMessageListener(){chrome.runtime.onMessage.addListener((e,n,t)=>{if(e.action==="processDay")return this.processCurrentDayLineup().then(o=>{t({success:!0,dayResult:o})}).catch(o=>{t({success:!1,error:o.message,dayResult:{date:this.getCurrentDate().toISOString().split("T")[0]||"",started:0,exceptions:[`Error: ${o.message}`],needsManualSelection:!0}})}),!0;if(e.action==="getLeagueInfo"){try{const o=this.getLeagueInfo();t(o)}catch{t({leagueName:"Fantasy League",teamName:"My Team"})}return!0}return!1})}async processCurrentDayLineup(){const e=this.getCurrentDate(),t={date:this.formatDate(e),started:0,exceptions:[],needsManualSelection:!1};if(console.log("Checking for bench players with games..."),!this.hasBenchPlayersWithGames())return console.log("No bench players with games found"),t;console.log("Found bench players with games, looking for 'Start Active Players' button...");const r=this.findStartActivePlayersButton();if(!r)return console.log("No 'Start Active Players' button found"),t.exceptions.push("No 'Start Active Players' button found on this page"),t.needsManualSelection=!0,t;console.log("Found 'Start Active Players' button, clicking it...");try{r.click(),await this.handleStartActivePlayersModal();const a=this.getRemainingBenchPlayersWithGames();a.length>0&&(t.exceptions.push(`Remaining bench players with games: ${a.join(", ")}`),t.needsManualSelection=!0);const s=this.countTotalActivePlayersWithGames();t.started=s,console.log(`Total active players with games: ${s}, ${a.length} remain on bench`)}catch(a){console.error("Error clicking 'Start Active Players' button:",a),t.exceptions.push(`Error clicking button: ${a.message}`),t.needsManualSelection=!0}return t}hasBenchPlayersWithGames(){const e=document.querySelectorAll('tr.bench[data-pos="BN"] .ysf-game-status a'),n=e.length>0;return console.log(`Found ${e.length} bench players with games`),n}findStartActivePlayersButton(){var n,t;const e=document.querySelectorAll('button, a, [role="button"]');for(let o=0;o<e.length;o++){const r=e[o],a=(n=r.textContent)==null?void 0:n.trim(),s=r.className;if(a==="Start Active Players"&&s.includes("start-active-players"))return console.log("Found 'Start Active Players' button with classes:",s),r}for(let o=0;o<e.length;o++){const r=e[o];if(((t=r.textContent)==null?void 0:t.trim())==="Start Active Players")return console.log("Found 'Start Active Players' button by text only"),r}return null}async handleStartActivePlayersModal(){await this.delay(1e3);const e=document.querySelector('[role="dialog"], .modal, .ysf-modal');if(e){console.log("Modal detected, looking for confirm button...");const n=e.querySelector('button[type="submit"], .btn-primary, .confirm-btn, button:contains("OK"), button:contains("Confirm")');n?(console.log("Found confirm button, clicking it..."),n.click(),await this.delay(1e3)):(console.log("No confirm button found, trying Escape key..."),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"})),await this.delay(1e3))}}getRemainingBenchPlayersWithGames(){var t,o,r;const e=[],n=document.querySelectorAll('tr.bench[data-pos="BN"]');for(let a=0;a<n.length;a++){const s=n[a],l=s.querySelector(".ysf-game-status a");if(l&&((t=l.textContent)!=null&&t.includes("pm")||(o=l.textContent)!=null&&o.includes("am"))){const i=s.querySelector('a[href*="player"]'),c=(r=i==null?void 0:i.textContent)==null?void 0:r.trim();c&&e.push(c)}}return console.log(`Remaining bench players with games: ${e.join(", ")}`),e}countTotalActivePlayersWithGames(){var s;const e=document.querySelector('th[title="Opponents"]');if(!e)return console.log("Could not find Opponents header"),0;const n=e.parentElement;if(!n)return console.log("Could not find header row"),0;const o=Array.from(n.children).indexOf(e)+1;console.log(`Opponent column is at index: ${o}`);const r=document.querySelectorAll("tr.editable[data-pos]");let a=0;for(let l=0;l<r.length;l++){const c=r[l].querySelector(`td:nth-child(${o})`);c&&((s=c.textContent)!=null&&s.trim())&&c.textContent.trim()!==""&&a++}return console.log(`Found ${a} total active players with games`),a}getCurrentDate(){const n=new URLSearchParams(window.location.search).get("date");if(n){const t=new Date(n);if(!isNaN(t.getTime()))return t}return new Date}formatDate(e){return e.toISOString().split("T")[0]||""}delay(e){return new Promise(n=>setTimeout(n,e))}getLeagueInfo(){try{const e=document.title,n=e.indexOf(" | ");return n===-1?{leagueName:"Fantasy League",teamName:"My Team"}:{leagueName:e.substring(0,n).trim(),teamName:""}}catch(e){return console.error("Error getting league info:",e),{leagueName:"Fantasy League",teamName:"My Team"}}}}new u;window.YahooFantasyAutomator=u;
