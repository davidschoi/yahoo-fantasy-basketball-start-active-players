class u{constructor(){this.setupMessageListener()}setupMessageListener(){chrome.runtime.onMessage.addListener((e,n,t)=>{if(e.action==="processDay")return this.processCurrentDayLineup().then(a=>{t({success:!0,dayResult:a})}).catch(a=>{t({success:!1,error:a.message,dayResult:{date:this.getCurrentDate().toISOString().split("T")[0]||"",started:0,exceptions:[`Error: ${a.message}`],needsManualSelection:!0}})}),!0;if(e.action==="getLeagueInfo"){try{const a=this.getLeagueInfo();t(a)}catch{t({leagueName:"Fantasy League",teamName:"My Team"})}return!0}return!1})}async processCurrentDayLineup(){const e=this.getCurrentDate(),t={date:this.formatDate(e),started:0,exceptions:[],needsManualSelection:!1};if(console.log("Checking for bench players with games..."),!this.hasBenchPlayersWithGames())return console.log("No bench players with games found"),t;console.log("Found bench players with games, looking for 'Start Active Players' button...");const r=this.findStartActivePlayersButton();if(!r)return console.log("No 'Start Active Players' button found"),t.exceptions.push("No 'Start Active Players' button found on this page"),t.needsManualSelection=!0,t;console.log("Found 'Start Active Players' button, clicking it...");try{r.click(),await this.handleStartActivePlayersModal();const o=this.getRemainingBenchPlayersWithGames();o.length>0&&(t.exceptions.push(`Remaining bench players with games: ${o.join(", ")}`),t.needsManualSelection=!0);const s=this.countTotalActivePlayersWithGames();t.started=s,console.log(`Total active players with games: ${s}, ${o.length} remain on bench`)}catch(o){console.error("Error clicking 'Start Active Players' button:",o),t.exceptions.push(`Error clicking button: ${o.message}`),t.needsManualSelection=!0}return t}hasBenchPlayersWithGames(){const e=document.querySelectorAll('tr.bench[data-pos="BN"] .ysf-game-status a'),n=e.length>0;return console.log(`Found ${e.length} bench players with games`),n}findStartActivePlayersButton(){var n,t;const e=document.querySelectorAll('button, a, [role="button"]');for(let a=0;a<e.length;a++){const r=e[a],o=(n=r.textContent)==null?void 0:n.trim(),s=r.className;if(o==="Start Active Players"&&s.includes("start-active-players"))return console.log("Found 'Start Active Players' button with classes:",s),r}for(let a=0;a<e.length;a++){const r=e[a];if(((t=r.textContent)==null?void 0:t.trim())==="Start Active Players")return console.log("Found 'Start Active Players' button by text only"),r}return null}async handleStartActivePlayersModal(){await this.delay(1e3);const e=document.querySelector('[role="dialog"], .modal, .ysf-modal');if(e){console.log("Modal detected, looking for confirm button...");const n=e.querySelector('button[type="submit"], .btn-primary, .confirm-btn, button:contains("OK"), button:contains("Confirm")');n?(console.log("Found confirm button, clicking it..."),n.click(),await this.delay(1e3)):(console.log("No confirm button found, trying Escape key..."),document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"})),await this.delay(1e3))}}getRemainingBenchPlayersWithGames(){var t,a,r;const e=[],n=document.querySelectorAll('tr.bench[data-pos="BN"]');for(let o=0;o<n.length;o++){const s=n[o],c=s.querySelector(".ysf-game-status a");if(c&&((t=c.textContent)!=null&&t.includes("pm")||(a=c.textContent)!=null&&a.includes("am"))){const l=s.querySelector('a[href*="player"]'),i=(r=l==null?void 0:l.textContent)==null?void 0:r.trim();i&&e.push(i)}}return console.log(`Remaining bench players with games: ${e.join(", ")}`),e}countTotalActivePlayersWithGames(){var t;const e=document.querySelectorAll("tr.editable[data-pos]");let n=0;for(let a=0;a<e.length;a++){const o=e[a].querySelector("td:nth-child(5)");o&&((t=o.textContent)!=null&&t.trim())&&o.textContent.trim()!==""&&n++}return console.log(`Found ${n} total active players with games`),n}getCurrentDate(){const n=new URLSearchParams(window.location.search).get("date");if(n){const t=new Date(n);if(!isNaN(t.getTime()))return t}return new Date}formatDate(e){return e.toISOString().split("T")[0]||""}delay(e){return new Promise(n=>setTimeout(n,e))}getLeagueInfo(){try{const e=document.title,n=e.indexOf(" | ");return n===-1?{leagueName:"Fantasy League",teamName:"My Team"}:{leagueName:e.substring(0,n).trim(),teamName:""}}catch(e){return console.error("Error getting league info:",e),{leagueName:"Fantasy League",teamName:"My Team"}}}}new u;window.YahooFantasyAutomator=u;
